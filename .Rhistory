star_g7_math <- star_g7 |>
filter(!is.na(g7tmathss))
# Define treatment and outcome vectors
W <- star_g7_math$W
outcome <- g7_outcomes[2]
Y <- star_g7_math |>
pull(outcome) |>
as.vector()
star_g7_x <- star_g7_math |>
select(-W, -stdntid) |>
select(!contains(c(g7_outcomes)))
n <-nrow(star_g7_math)
# Number of rankings predictions will be ranked on
num.rankings <- 5
# Prepare for data.splitting
# Assign a fold number to each observation.
# The argument 'clusters' in the next step will mimic K-fold cross-fitting.
num.folds <- 10
folds <- sort(seq(n) %% num.folds) + 1
# Estimate a causal forest
forest <- causal_forest(X = star_g7_x, Y=Y, W=W,
clusters = star_g7_x$g7schid,
min.node.size = 5)
test_calibration(forest, vcov.type = "HC0")
test_calibration(forest, vcov.type = "HC1")
forest <- causal_forest(X = star_g7_x, Y=Y, W=W,
min.node.size = 5)
hist(predict(forest)$predictions)
g7_ate_math <- average_treatment_effect(forest, target.sample = "overlap", method = "AIPW")
g7_ate_math_se <- g7_ate_math[2]
g7_ate_math <- g7_ate_math[1]
print(paste0("95% CI: ", round(g7_ate_math,2),
" +/- ", round(1.96 * g7_ate_math_se, 2)))
test_calibration(forest, vcov.type = "HC1")
length(unique(star$g1schid))
length(unique(star$gkschid))
length(unique(star$g2schid))
length(unique(star$g3schid))
length(unique(star$stdntid))
yearssmall_ols <- lm(g7tmathss ~ yearssmall, data=star_g7_math)
summary(yearssmall_ols)
yearssmall_ols <- lm(g7tmathss ~ as.factor(yearssmall), data=star_g7_math)
summary(yearssmall_ols)
yearssmall_ols <- lm(g7treadss ~ as.factor(yearssmall), data=star_g7_reading)
summary(yearssmall_ols)
ksmall_ols <- lm(g7tmathss ~ gk_smallclass, data=star_g7_math)
summary(ksmall_ols)
ksmall_ols <- lm(g7treadss ~ gk_smallclass, data=star_g7_reading)
summary(ksmall_ols)
g1small_ols <- lm(g7treadss ~ g1_smallclass, data=star_g7_reading)
summary(g1small_ols)
g2small_ols <- lm(g7treadss ~ g2_smallclass, data=star_g7_reading)
summary(g2small_ols)
g3small_ols <- lm(g7treadss ~ g3_smallclass, data=star_g7_reading)
summary(g3small_ols)
g1small_ols <- lm(g7tmathss ~ g1_smallclass, data=star_g7_math)
summary(g1small_ols)
g2small_ols <- lm(g7tmathss ~ g2_smallclass, data=star_g7_math)
summary(g2small_ols)
g3small_ols <- lm(g7tmathss ~ g3_smallclass, data=star_g7_math)
summary(g3small_ols)
yearssmall_ols <- lm(hsgpaoverall ~ as.factor(yearssmall), data=star_hs_1)
summary(yearssmall_ols)
bivariate_ols <- lm(hsgpaoverall ~ W, data=star_hs_1)
summary(bivariate_ols)
yearssmall_ols <- lm(hsgpaoverall ~ as.factor(yearssmall), data=star_hs_1)
summary(yearssmall_ols)
ksmall_ols <- lm(hsgpaoverall ~ gk_smallclass, data=star_hs_1)
summary(ksmall_ols)
g1small_ols <- lm(hsgpaoverall ~ g1_smallclass, data=star_hs_1)
summary(g1small_ols)
g2small_ols <- lm(hsgpaoverall ~ g2_smallclass, data=star_hs_1)
summary(g2small_ols)
g3small_ols <- lm(hsgpaoverall ~ g3_smallclass, data=star_hs_1)
summary(g3small_ols)
g1small_ols <- lm(hsgpaoverall ~ g1_smallclass + g1schid, data=star_hs_1)
summary(g1small_ols)
g1small_ols <- lm(g7tmathss ~ g1_smallclass + g1schid, data=star_g7_math)
summary(g1small_ols)
g1small_ols <- lm(g7tmathss ~ g1_smallclass, data=star_g7_math)
summary(g1small_ols)
summary(star$g1surban)
summarize(star$g1surban)
glimpse(star$g1surban)
g1small_ols <- lm(g7tmathss ~ g1_smallclass + as.factor(g1schid), data=star_g7_math)
summary(g1small_ols)
g1small_ols <- lm(g7tmathss ~ g1_smallclass + as.factor(g1schid) + as.factor(g1urban), data=star_g7_math)
summary(g1small_ols)
g1small_ols <- lm(g7tmathss ~ g1_smallclass
+ as.factor(g1schid)
+ as.factor(g1urban)
+ as.factor(g1race)
, data=star_g7_math)
g1small_ols <- lm(g7tmathss ~ g1_smallclass + as.factor(g1schid) + as.factor(g1urban) + as.factor(g1race)
, data=star_g7_math)
summary(g1small_ols)
View(star)
forest <- causal_forest(X = star_g7_x, Y=Y, W=W,
clusters = as.factor(star_g7_x$g7schid),
min.node.size = 5)
hist(predict(forest)$predictions)
g7_ate_math <- average_treatment_effect(forest, target.sample = "overlap", method = "AIPW")
g7_ate_math_se <- g7_ate_math[2]
g7_ate_math <- g7_ate_math[1]
print(paste0("95% CI: ", round(g7_ate_math,2),
" +/- ", round(1.96 * g7_ate_math_se, 2)))
?causal_forest
star <- star |>
select(-birthmonth,
-birthday,
-birthyear)
star <- star |>
select(-birthmonth,
-birthday,
-birthyear,
-across(starts_with("flagsg")))
star <- star |>
select( -across(starts_with("flagsg")))
star <- star |>
select(starts_with(across("flagsg")))
star <- star |>
select(starts_with(across("flagsg"))
star <- star |>
select(-starts_with(across("flagsg"))
star <- star |>
select(-starts_with("flagsg"))
star |> names(starts_with("flag"))
star |> names(startsWith("flag"))
star |> select(starts_with("flag"))
glimpse(star$hslvlmth)
star <- star |>
select(!starts_with(c("birth",
"flag",
"schlurban"))) |>
select(-yearsstar,
-hsyrscor,
-hsctsrc)
star_short_term <- star[,!(names(star) %in% drop_for_short_term)]
# Drop future (beyond grade 3) outcomes and characteristics
star_short_term <- star_short_term %>%
select(!starts_with(c("g4", "g5", "g6", "g7", "g8" , "hs")))
# LONG TERM OUTCOMES
#7TH GRADE
# Define one long term outcome: 7th grade outcomes
g7_outcomes <- c("g7treadss", "g7tmathss")
# List of variables to drop when predicting 7th grade outcomes
drop_for_g7 <- c("g7tlangss","g7tbattss", "g7sciencess", "g7socialsciss",
"g7readcomprehss", "g7spellss", "g7vocabss", "g7mathcomputss",
"g7mathconcapplss", "g7langexpss", "g7langmechss",
"g7studyskillss", "g7readbsobjraw", "g7mathbsobjraw")
# Drop the other grade 7 outcomes from the list above
star_g7 <- star[,!(names(star) %in% drop_for_g7)]
# Drop future (beyond grade 7) outcomes and characteristics)
star_g7 <- star_g7 |>
select(!starts_with(c("g8", "hs")))
# high school GPA
hs_outcomes <- c("hsgpaoverall")
#drop other HS GPA outcomes
drop_for_hs <- c("hsgpaflang", "hsgpamath", "hsgpascience")
# Drop the other HS GPA outcomes from the list above
star_hs <- star[,!(names(star) %in% drop_for_hs)]
set.seed(123)
#G7 MATH OUTCOMES
star_g7_math <- star_g7 |>
filter(!is.na(g7tmathss))
# Define treatment and outcome vectors
W <- star_g7_math$W
outcome <- g7_outcomes[2]
Y <- star_g7_math |>
pull(outcome) |>
as.vector()
star_g7_x <- star_g7_math |>
select(-W, -stdntid) |>
select(!contains(c(g7_outcomes)))
n <-nrow(star_g7_math)
# Number of rankings predictions will be ranked on
num.rankings <- 5
# Prepare for data.splitting
# Assign a fold number to each observation.
# The argument 'clusters' in the next step will mimic K-fold cross-fitting.
num.folds <- 10
folds <- sort(seq(n) %% num.folds) + 1
# Estimate a causal forest
forest <- causal_forest(X = star_g7_x, Y=Y, W=W,
clusters = as.factor(star_g7_x$g7schid),
min.node.size = 5)
hist(predict(forest)$predictions)
g7_ate_math <- average_treatment_effect(forest, target.sample = "overlap", method = "AIPW")
g7_ate_math_se <- g7_ate_math[2]
g7_ate_math <- g7_ate_math[1]
#not statistically significant
print(paste0("95% CI: ", round(g7_ate_math,2),
" +/- ", round(1.96 * g7_ate_math_se, 2)))
test_calibration(forest)
var_importance <- variable_importance(forest) |>
as_tibble() |>
mutate(n_col = row_number()) |>
arrange(-V1)
important_vars_g7_math <- var_importance %>%
slice(1:10) %>%
pull(n_col)
important_vars_g7_math <- names(star_g7_x[important_vars_g7_math])
important_vars_g7_math
options(stringAsFactors=FALSE)
star <- read_sav("./data/STAR_Students.sav")
names(star) <- tolower(names(star))
star <- read_sav("./data/STAR_Students.sav")
star <- <- read_sav("data/STAR_Students.sav")
star <- read_sav("data/STAR_Students.sav")
fmla <- as.formula(paste0(Y, "~ ", Y, paste("as.factor(", covariates, ")", collapse="+")))
covariates
+ as.factor(g3freelunch), data=star_g7_math)
count(star_g7, gkrepeat)
bivariate_ols <- lm(g7tmathss ~ W + as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(g2schid)
+ as.factor(g3schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(g2surban)
+ as.factor(g3surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(g2thighdegree)
+ as.factor(g3thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(g2freelunch)
+ as.factor(g3freelunch)
+ as.factor(gkrepeat)
+ as.factor(g1repeat)
+ as.factor(g2repeat)
+ as.factor(g3repeat)
+ gktyears
+ g1tyears
+ g2tyears
+ g3tyears
+ as.factor(gkspeced)
+ as.factor(g1speced)
+ as.factor(g2speced)
+ as.factor(g3speced), data=star_g7_math)
bivariate_ols <- lm(g7tmathss ~ W + as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(g2schid)
+ as.factor(g3schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(g2surban)
+ as.factor(g3surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(g2thighdegree)
+ as.factor(g3thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(g2freelunch)
+ as.factor(g3freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ g2tyears
+ g3tyears
+ as.factor(gkspeced)
+ as.factor(g1speced)
+ as.factor(g2speced)
+ as.factor(g3speced), data=star_g7_math)
bivariate_ols <- lm(g7tmathss ~ W + as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(g2schid)
+ as.factor(g3schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(g2surban)
+ as.factor(g3surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(g2thighdegree)
+ as.factor(g3thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(g2freelunch)
+ as.factor(g3freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ g2tyears
+ g3tyears
+ as.factor(gkspeced)
+ as.factor(g1speced), data=star_g7_math)
summary(bivariate_ols)
yearssmall_ols <- lm(g7tmathss ~ as.factor(yearssmall) +as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(g2schid)
+ as.factor(g3schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(g2surban)
+ as.factor(g3surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(g2thighdegree)
+ as.factor(g3thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(g2freelunch)
+ as.factor(g3freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ g2tyears
+ g3tyears
+ as.factor(gkspeced)
+ as.factor(g1speced), data=star_g7_math)
summary(yearssmall_ols)
ksmall_ols <- lm(g7tmathss ~ gk_smallclass +as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(g2schid)
+ as.factor(g3schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(g2surban)
+ as.factor(g3surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(g2thighdegree)
+ as.factor(g3thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(g2freelunch)
+ as.factor(g3freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ g2tyears
+ g3tyears
+ as.factor(gkspeced)
+ as.factor(g1speced), data=star_g7_math)
summary(ksmall_ols)
ksmall_ols <- lm(g7tmathss ~ gk_smallclass +as.factor(gkschid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(gkthighdegree)
+ as.factor(gkfreelunch)
+ as.factor(gkrepeat)
+ gktyears
+ as.factor(gkspeced), data=star_g7_math)
summary(ksmall_ols)
glimpse(star_g7$race)
g1small_ols <- lm(g7tmathss ~ g1_smallclass +as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ as.factor(gkspeced)
+ as.factor(g1speced), data=star_g7_math)
summary(g1small_ols)
g2small_ols <- lm(g7tmathss ~ g2_smallclass+as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(g2schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(g2surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(g2thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(g2freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ g2tyears
+ as.factor(gkspeced)
+ as.factor(g1speced), data=star_g7_math)
summary(g2small_ols)
g3small_ols <- lm(g7tmathss ~ g3_smallclass + as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(g2schid)
+ as.factor(g3schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(g2surban)
+ as.factor(g3surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(g2thighdegree)
+ as.factor(g3thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(g2freelunch)
+ as.factor(g3freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ g2tyears
+ g3tyears
+ as.factor(gkspeced)
+ as.factor(g1speced), data=star_g7_math)
summary(g3small_ols)
bivariate_ols <- lm(g7treadss ~ W + as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(g2schid)
+ as.factor(g3schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(g2surban)
+ as.factor(g3surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(g2thighdegree)
+ as.factor(g3thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(g2freelunch)
+ as.factor(g3freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ g2tyears
+ g3tyears
+ as.factor(gkspeced)
+ as.factor(g1speced), data=star_g7_reading)
summary(bivariate_ols)
bivariate_ols <- lm(g7tmathss ~ W + as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(g2schid)
+ as.factor(g3schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(g2surban)
+ as.factor(g3surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(g2thighdegree)
+ as.factor(g3thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(g2freelunch)
+ as.factor(g3freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ g2tyears
+ g3tyears
+ as.factor(gkspeced)
+ as.factor(g1speced), data=star_g7_math)
summary(bivariate_ols)
yearssmall_ols <- lm(g7treadss ~ as.factor(yearssmall) +as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(g2schid)
+ as.factor(g3schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(g2surban)
+ as.factor(g3surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(g2thighdegree)
+ as.factor(g3thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(g2freelunch)
+ as.factor(g3freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ g2tyears
+ g3tyears
+ as.factor(gkspeced)
+ as.factor(g1speced), data=star_g7_reading)
summary(yearssmall_ols)
ksmall_ols <- lm(g7treadss ~ gk_smallclass +as.factor(gkschid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(gkthighdegree)
+ as.factor(gkfreelunch)
+ as.factor(gkrepeat)
+ gktyears
+ as.factor(gkspeced), data=star_g7_reading)
summary(ksmall_ols)
g1small_ols <- lm(g7treadss ~ g1_smallclass +as.factor(gkschid)
+ as.factor(g1schid)
+ as.factor(race)
+ as.factor(gksurban)
+ as.factor(g1surban)
+ as.factor(gkthighdegree)
+ as.factor(g1thighdegree)
+ as.factor(gkfreelunch)
+ as.factor(g1freelunch)
+ as.factor(gkrepeat)
+ gktyears
+ g1tyears
+ as.factor(gkspeced)
+ as.factor(g1speced), data=star_g7_reading)
summary(g1small_ols)
